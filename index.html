<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PARADOKS ALIBI - Detective Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=Source+Sans+Pro:wght@400;600&family=Courier+Prime&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --blood: #8b0000;
            --blood-light: #cc0000;
            --gold: #d4af37;
            --gold-dark: #aa8a2e;
            --paper: #f5f0e6;
            --paper-dark: #e6dfd0;
            --ink: #1a1a1a;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            font-family: 'Source Sans Pro', sans-serif;
            background: #0d0d0d;
            color: #e8e0d0;
            line-height: 1.6;
        }

        /* ===== START SCREEN ===== */
        #startScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(180deg, #0a0505 0%, #1a0a0a 50%, #0a0505 100%);
            padding: 20px;
            text-align: center;
        }

        #startScreen.hidden {
            display: none;
        }

        .start-logo {
            font-size: 4rem;
            margin-bottom: 1rem;
            animation: float 3s ease-in-out infinite;
            filter: drop-shadow(0 0 20px rgba(139,0,0,0.5));
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .start-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 8vw, 3.5rem);
            font-weight: 900;
            color: #fff;
            text-shadow: 0 0 40px rgba(139,0,0,0.6);
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        .start-subtitle {
            font-family: 'Courier Prime', monospace;
            font-size: clamp(0.7rem, 2.5vw, 0.9rem);
            color: var(--gold);
            letter-spacing: 0.3em;
            text-transform: uppercase;
            margin-bottom: 2rem;
        }

        .start-tagline {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            color: #888;
            max-width: 400px;
            margin-bottom: 2.5rem;
        }

        .start-btn {
            display: inline-block;
            padding: 1rem 2.5rem;
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: #fff;
            background: linear-gradient(135deg, var(--blood) 0%, #5c0000 100%);
            border: 2px solid var(--gold);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: 0 5px 30px rgba(139,0,0,0.4);
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 40px rgba(139,0,0,0.6);
            background: linear-gradient(135deg, #aa0000 0%, #6c0000 100%);
        }

        .start-btn:active {
            transform: translateY(0);
        }

        .start-version {
            position: absolute;
            bottom: 20px;
            font-family: 'Courier Prime', monospace;
            font-size: 0.7rem;
            color: #444;
        }

        /* ===== MAIN GAME ===== */
        #gameContainer {
            display: none;
            max-width: 1400px;
            margin: 0 auto;
            padding: 1rem;
            min-height: 100vh;
        }

        #gameContainer.visible {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Header */
        .game-header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, rgba(20,10,5,0.95) 0%, rgba(30,15,10,0.95) 100%);
            border: 1px solid rgba(212,175,55,0.3);
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .case-info h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(1rem, 4vw, 1.4rem);
            color: var(--gold);
        }

        .case-number { color: var(--blood-light); }

        .case-status {
            font-family: 'Courier Prime', monospace;
            font-size: 0.65rem;
            color: #666;
        }

        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #ff4444;
            border-radius: 50%;
            margin-right: 5px;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Action Points */
        .ap-container {
            text-align: center;
        }

        .ap-label {
            font-family: 'Courier Prime', monospace;
            font-size: 0.6rem;
            color: #777;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.3rem;
        }

        .ap-dots {
            display: flex;
            gap: 6px;
            justify-content: center;
        }

        .ap-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gold) 0%, var(--gold-dark) 100%);
            box-shadow: 0 2px 8px rgba(212,175,55,0.4);
            transition: all 0.3s ease;
        }

        .ap-dot.used {
            background: #333;
            box-shadow: none;
        }

        /* Stats */
        .stats-row {
            display: flex;
            gap: 1.5rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-label {
            font-family: 'Courier Prime', monospace;
            font-size: 0.55rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-value {
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .stat-value.rep { color: var(--success); }
        .stat-value.rep.low { color: var(--danger); }
        .stat-value.solved { color: var(--gold); }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 1000px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Left Panel */
        .left-panel {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .panel-card {
            background: linear-gradient(135deg, var(--paper) 0%, var(--paper-dark) 100%);
            padding: 1.2rem;
            border-radius: 4px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            color: var(--ink);
        }

        .panel-title {
            font-family: 'Courier Prime', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--blood);
            border-bottom: 2px solid rgba(139,0,0,0.2);
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Timeline */
        .timeline-item {
            display: flex;
            gap: 0.8rem;
            padding: 0.6rem 0;
            border-left: 2px solid var(--gold-dark);
            padding-left: 1rem;
            margin-left: 0.5rem;
            position: relative;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -5px;
            top: 0.8rem;
            width: 8px;
            height: 8px;
            background: var(--gold);
            border-radius: 50%;
        }

        .timeline-item.critical::before {
            background: var(--blood);
        }

        .timeline-time {
            font-family: 'Courier Prime', monospace;
            font-size: 0.75rem;
            color: var(--blood);
            font-weight: 600;
            min-width: 45px;
        }

        .timeline-event {
            font-size: 0.85rem;
            line-height: 1.4;
        }

        /* Evidence */
        .evidence-board {
            background: linear-gradient(135deg, #2d1810 0%, #1a0f0a 100%);
            padding: 1rem;
            border-radius: 4px;
            color: #e8e0d0;
        }

        .evidence-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.8rem;
        }

        .evidence-card {
            background: var(--paper);
            padding: 0.8rem;
            border-radius: 2px;
            color: var(--ink);
            box-shadow: 2px 3px 8px rgba(0,0,0,0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 80px;
        }

        .evidence-card:hover {
            transform: translateY(-2px);
            box-shadow: 4px 6px 15px rgba(0,0,0,0.4);
        }

        .evidence-card.locked {
            background: #444;
            color: #888;
        }

        .evidence-card.locked::after {
            content: 'üîí';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
        }

        .evidence-card.locked .ev-content {
            opacity: 0;
        }

        .ev-category {
            font-family: 'Courier Prime', monospace;
            font-size: 0.55rem;
            color: var(--blood);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .ev-label {
            font-family: 'Playfair Display', serif;
            font-size: 0.8rem;
            font-weight: 700;
            margin: 0.2rem 0;
        }

        .ev-desc {
            font-size: 0.75rem;
            color: #555;
            line-height: 1.4;
        }

        /* Connections Panel */
        .connections-panel {
            background: rgba(0,0,0,0.4);
            padding: 1rem;
            border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .connection-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0;
            font-size: 0.8rem;
            color: #666;
        }

        .connection-item.found {
            color: var(--success);
        }

        .connection-item.found::before {
            content: '‚úì';
            color: var(--success);
        }

        .connection-item:not(.found)::before {
            content: '?';
            color: #666;
        }

        /* Right Panel - Suspects */
        .right-panel h2 {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            color: var(--paper);
            margin-bottom: 1rem;
        }

        .suspects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.2rem;
        }

        .suspect-card {
            background: #fff;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .suspect-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .suspect-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            border-bottom: 3px solid var(--gold);
        }

        .suspect-avatar {
            font-size: 2.5rem;
            filter: grayscale(30%);
        }

        .suspect-info h3 {
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            color: var(--ink);
        }

        .suspect-role {
            font-family: 'Courier Prime', monospace;
            font-size: 0.65rem;
            color: #777;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .suspect-body {
            padding: 1rem;
        }

        .statement-box {
            background: #f9f7f4;
            padding: 0.8rem;
            border-radius: 4px;
            margin-bottom: 0.5rem;
            border-left: 3px solid #ddd;
        }

        .statement-box.interrogated {
            border-left-color: var(--gold);
            background: #fffbf0;
        }

        .statement-box.secret {
            border-left-color: var(--warning);
            background: #fff8e6;
        }

        .statement-label {
            font-family: 'Courier Prime', monospace;
            font-size: 0.55rem;
            color: #999;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.3rem;
        }

        .statement-text {
            font-size: 0.85rem;
            color: var(--ink);
            line-height: 1.5;
            font-style: italic;
        }

        .suspect-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.7rem 1rem;
            font-family: 'Courier Prime', monospace;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-investigate {
            background: var(--ink);
            color: #fff;
        }

        .btn-investigate:hover:not(:disabled) {
            background: #333;
        }

        .btn-investigate:disabled {
            background: #ccc;
            color: #888;
            cursor: not-allowed;
        }

        .btn-accuse {
            background: transparent;
            color: var(--blood);
            border: 2px solid var(--blood);
        }

        .btn-accuse:hover {
            background: var(--blood);
            color: #fff;
        }

        .ap-cost {
            background: rgba(212,175,55,0.2);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.6rem;
        }

        /* Action Bar */
        .action-bar {
            margin-top: 1.5rem;
            padding: 1rem 1.5rem;
            background: rgba(0,0,0,0.4);
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .action-bar.danger {
            background: rgba(139,0,0,0.3);
            border: 1px solid var(--blood);
            animation: pulse-danger 1s infinite;
        }

        @keyframes pulse-danger {
            0%, 100% { box-shadow: 0 0 0 0 rgba(139,0,0,0); }
            50% { box-shadow: 0 0 20px 5px rgba(139,0,0,0.3); }
        }

        .action-message {
            font-size: 0.9rem;
            color: #888;
        }

        .action-message.warning { color: var(--warning); }
        .action-message.danger { color: var(--danger); font-weight: 600; }

        .btn-skip {
            padding: 0.5rem 1rem;
            background: transparent;
            border: 1px solid #555;
            color: #777;
            font-family: 'Courier Prime', monospace;
            font-size: 0.65rem;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .btn-skip:hover {
            border-color: #888;
            color: #aaa;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 20px;
        }

        .modal-overlay.visible {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-box {
            background: var(--paper);
            max-width: 500px;
            width: 100%;
            padding: 2rem;
            border-radius: 8px;
            position: relative;
            color: var(--ink);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-icon {
            position: absolute;
            top: -20px;
            left: -20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .modal-icon.success { background: var(--success); }
        .modal-icon.error { background: var(--blood); }

        .modal-title {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            margin-bottom: 0.5rem;
        }

        .modal-title.success { color: var(--success); }
        .modal-title.error { color: var(--blood); }

        .modal-divider {
            width: 50px;
            height: 3px;
            background: var(--ink);
            margin-bottom: 1rem;
        }

        .modal-content {
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .deduction-steps {
            background: rgba(0,0,0,0.05);
            padding: 1rem;
            border-radius: 4px;
            margin-top: 1rem;
        }

        .deduction-step {
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
        }

        .step-num {
            background: var(--blood);
            color: #fff;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            flex-shrink: 0;
        }

        .btn-modal {
            width: 100%;
            padding: 1rem;
            background: var(--ink);
            color: #fff;
            font-family: 'Playfair Display', serif;
            font-size: 0.9rem;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.3s ease;
        }

        .btn-modal:hover {
            background: var(--blood);
        }

        /* Game Over */
        #gameOver {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #1a0000 0%, #0a0000 100%);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            text-align: center;
            padding: 20px;
        }

        #gameOver.visible {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        .gameover-title {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 8vw, 3.5rem);
            color: #fff;
            text-shadow: 0 0 50px rgba(139,0,0,0.8);
            margin-bottom: 0.5rem;
        }

        .gameover-sub {
            color: #ff6666;
            font-size: 1rem;
            margin-bottom: 2rem;
        }

        .gameover-stat {
            margin-bottom: 2rem;
        }

        .gameover-stat-value {
            font-family: 'Playfair Display', serif;
            font-size: 3rem;
            color: var(--gold);
        }

        .gameover-stat-label {
            font-family: 'Courier Prime', monospace;
            font-size: 0.7rem;
            color: #888;
            text-transform: uppercase;
        }

        .btn-retry {
            padding: 1rem 2.5rem;
            background: transparent;
            border: 2px solid #fff;
            color: #fff;
            font-family: 'Playfair Display', serif;
            font-size: 1rem;
            font-weight: 700;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-retry:hover {
            background: #fff;
            color: #1a0000;
        }
    </style>
</head>
<body>

    <!-- START SCREEN -->
    <div id="startScreen">
        <div class="start-logo">üîç</div>
        <h1 class="start-title">PARADOKS ALIBI</h1>
        <p class="start-subtitle">Detective Logic Game</p>
        <p class="start-tagline">"Setiap alibi menyimpan kebohongan. Temukan kontradiksinya."</p>
        <button class="start-btn" onclick="startGame()">MULAI INVESTIGASI</button>
        <p class="start-version">v4.0 ‚Äî Multi-Layer Deduction System</p>
    </div>

    <!-- MAIN GAME -->
    <div id="gameContainer">
        <!-- Header -->
        <header class="game-header">
            <div class="case-info">
                <h1>KASUS <span class="case-number" id="caseNumber">#000</span></h1>
                <p class="case-status"><span class="status-dot"></span>INVESTIGASI AKTIF</p>
            </div>

            <div class="ap-container">
                <div class="ap-label">Poin Aksi</div>
                <div class="ap-dots" id="apDots">
                    <div class="ap-dot"></div>
                    <div class="ap-dot"></div>
                    <div class="ap-dot"></div>
                    <div class="ap-dot"></div>
                    <div class="ap-dot"></div>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-item">
                    <div class="stat-label">Reputasi</div>
                    <div class="stat-value rep" id="repValue">100</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">Terpecahkan</div>
                    <div class="stat-value solved" id="solvedValue">0</div>
                </div>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Left Panel -->
            <div class="left-panel">
                <!-- Timeline -->
                <div class="panel-card">
                    <h3 class="panel-title">‚è±Ô∏è Kronologi Kejadian</h3>
                    <div id="timelineList"></div>
                </div>

                <!-- Evidence -->
                <div class="evidence-board">
                    <h3 class="panel-title" style="color: var(--gold);">üìÅ Bukti & Data</h3>
                    <div class="evidence-grid" id="evidenceGrid"></div>
                </div>

                <!-- Connections -->
                <div class="connections-panel">
                    <h3 class="panel-title" style="color: var(--gold); border-color: rgba(212,175,55,0.3);">üîó Koneksi Ditemukan</h3>
                    <div id="connectionsList"></div>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <h2>üë• Daftar Tersangka</h2>
                <div class="suspects-grid" id="suspectsGrid"></div>

                <div class="action-bar" id="actionBar">
                    <p class="action-message" id="actionMessage">Kumpulkan bukti dan interogasi tersangka untuk menemukan kontradiksi.</p>
                    <button class="btn-skip" onclick="skipCase()">Lewati Kasus (-30 Rep)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- RESULT MODAL -->
    <div class="modal-overlay" id="resultModal">
        <div class="modal-box">
            <div class="modal-icon" id="modalIcon">‚úì</div>
            <h2 class="modal-title" id="modalTitle">HASIL</h2>
            <div class="modal-divider"></div>
            <div class="modal-content" id="modalContent"></div>
            <div class="deduction-steps" id="deductionSteps" style="display:none;"></div>
            <button class="btn-modal" id="modalBtn">LANJUTKAN</button>
        </div>
    </div>

    <!-- GAME OVER -->
    <div id="gameOver">
        <h1 class="gameover-title">KARIR BERAKHIR</h1>
        <p class="gameover-sub">Reputasi Anda hancur. Izin investigasi dicabut.</p>
        <div class="gameover-stat">
            <div class="gameover-stat-value" id="finalSolved">0</div>
            <div class="gameover-stat-label">Kasus Terpecahkan</div>
        </div>
        <button class="btn-retry" onclick="location.reload()">COBA LAGI</button>
    </div>

    <script>
        // ===== DATA BANKS =====
        const SUSPECTS_POOL = [
            { name: "Budi Santoso", role: "Supir Pribadi", avatar: "üë®üèª" },
            { name: "Siti Aminah", role: "Asisten Rumah Tangga", avatar: "üë©üèª" },
            { name: "Kevin Wijaya", role: "Anak Bungsu", avatar: "üßëüèª" },
            { name: "Pak Karno", role: "Ketua RT", avatar: "üë¥üèª" },
            { name: "Linda Kusuma", role: "Sekretaris", avatar: "üë©üèª‚Äçüíº" },
            { name: "Agus Pratama", role: "Satpam", avatar: "üëÆüèª" },
            { name: "Rina Marlina", role: "Tetangga", avatar: "üëßüèª" },
            { name: "Hendra Gunawan", role: "Rekan Bisnis", avatar: "üë®üèª‚Äçüíº" },
            { name: "Dewi Lestari", role: "Istri Muda", avatar: "üíÉüèª" },
            { name: "Joko Widodo", role: "Tukang Kebun", avatar: "üë®üèª‚Äçüåæ" },
            { name: "Maya Sari", role: "Perawat", avatar: "üë©üèª‚Äç‚öïÔ∏è" },
            { name: "Rudi Hartono", role: "Kolektor Hutang", avatar: "üï¥üèª" }
        ];

        const RED_HERRINGS = [
            { secret: "Mencuri uang kas RT", confession: "Saya akui... saya mengambil uang kas. Tapi saya bukan pembunuh!" },
            { secret: "Berselingkuh", confession: "Ya, saya punya hubungan terlarang. Tapi itu bukan motif pembunuhan!" },
            { secret: "Memalsukan ijazah", confession: "Ijazah saya palsu, tapi tidak ada hubungannya dengan kematian korban!" },
            { secret: "Berjudi online", confession: "Saya terjerat judi online... tapi saya tidak membunuh!" },
            { secret: "Menjual barang curian", confession: "Ya, saya menjual barang majikan... tapi pembunuhan? Tidak!" }
        ];

        const CASE_TEMPLATES = [
            {
                id: "phone_bts",
                generate: () => ({
                    timeline: [
                        { time: "19:00", event: "Korban terakhir terlihat hidup", critical: false },
                        { time: "20:15", event: "Tetangga mendengar keributan", critical: true },
                        { time: "20:30", event: "Panggilan telepon ke korban", critical: true },
                        { time: "20:45", event: "Waktu kematian (forensik)", critical: true },
                        { time: "21:30", event: "Korban ditemukan", critical: false }
                    ],
                    evidence: [
                        { type: "open", cat: "Forensik", label: "Waktu Kematian", desc: "Kematian antara 20:40-20:50" },
                        { type: "open", cat: "Digital", label: "Log Panggilan", desc: "Telepon ke korban jam 20:30" },
                        { type: "locked", cat: "Telekomunikasi", label: "Data BTS", desc: "HP pelaku terhubung tower Menteng, bukan Kemang" },
                        { type: "locked", cat: "Forensik", label: "Posisi Tubuh", desc: "Korban memegang HP saat ditemukan" }
                    ],
                    killerAlibi: {
                        initial: "Saya di Kemang jam 8 malam, makan di restoran.",
                        interrogated: "Saya menelepon korban jam 20:30 dari restoran di Kemang.",
                        contradiction: "Data BTS membuktikan telepon dari Menteng (dekat TKP), bukan Kemang."
                    },
                    deductionSteps: [
                        "Telepon ke korban jam 20:30",
                        "Data BTS: lokasi di Menteng, bukan Kemang",
                        "Waktu kematian 20:45 - 15 menit setelah telepon",
                        "Pelaku ada di TKP saat pembunuhan"
                    ],
                    connections: [
                        { text: "Log telepon + Data BTS = Lokasi sebenarnya", requires: ["Log Panggilan", "Data BTS"] },
                        { text: "Waktu telepon + Waktu kematian = Jendela pembunuhan", requires: ["Waktu Kematian", "Log Panggilan"] }
                    ]
                })
            },
            {
                id: "digital_lock",
                generate: () => ({
                    timeline: [
                        { time: "22:00", event: "Korban masuk apartemen", critical: false },
                        { time: "22:15", event: "Listrik padam 10 menit", critical: true },
                        { time: "22:25", event: "Listrik menyala", critical: false },
                        { time: "23:00", event: "Pelaku klaim pulang", critical: true },
                        { time: "07:00", event: "Korban ditemukan, pintu terkunci", critical: true }
                    ],
                    evidence: [
                        { type: "open", cat: "TKP", label: "Kondisi Pintu", desc: "Terkunci dari dalam dengan deadbolt" },
                        { type: "open", cat: "Digital", label: "CCTV Lobby", desc: "Korban masuk 22:00, tidak ada yang keluar" },
                        { type: "locked", cat: "Digital", label: "Log Kunci Digital", desc: "Master key diakses jam 22:18 saat mati lampu" },
                        { type: "locked", cat: "Arsitektur", label: "Denah Gedung", desc: "Ada connecting door antar unit" }
                    ],
                    killerAlibi: {
                        initial: "Saya di apartemen sendiri sepanjang malam.",
                        interrogated: "Saat mati lampu, saya panik dan tetap di kamar.",
                        contradiction: "Log kunci digital: master key digunakan saat mati lampu. Pelaku masuk via master key, keluar via connecting door."
                    },
                    deductionSteps: [
                        "Pintu terkunci dari dalam",
                        "Master key digunakan jam 22:18 (mati lampu)",
                        "Connecting door untuk keluar tanpa CCTV",
                        "Hanya pengelola punya master key"
                    ],
                    connections: [
                        { text: "Mati lampu + Log master key = Akses tersembunyi", requires: ["CCTV Lobby", "Log Kunci Digital"] },
                        { text: "Connecting door + Pintu terkunci = Metode keluar", requires: ["Kondisi Pintu", "Denah Gedung"] }
                    ]
                })
            },
            {
                id: "poison_allergy",
                generate: () => ({
                    timeline: [
                        { time: "18:00", event: "Makan malam keluarga", critical: false },
                        { time: "18:30", event: "Korban makan hidangan utama", critical: true },
                        { time: "19:00", event: "Korban mengeluh tidak enak badan", critical: true },
                        { time: "19:30", event: "Korban kolaps", critical: true },
                        { time: "20:00", event: "Polisi tiba", critical: false }
                    ],
                    evidence: [
                        { type: "open", cat: "Forensik", label: "Autopsi", desc: "Kematian karena reaksi anafilaksis" },
                        { type: "open", cat: "Makanan", label: "Menu Makan", desc: "Gulai Kambing, dimasak koki keluarga" },
                        { type: "locked", cat: "Medis", label: "Rekam Medis", desc: "Korban TIDAK punya alergi tercatat" },
                        { type: "locked", cat: "Toksikologi", label: "Lab Toxicology", desc: "Ditemukan chemical allergen buatan" }
                    ],
                    killerAlibi: {
                        initial: "Saya yang memasak, semua makan yang sama.",
                        interrogated: "Tidak mungkin ada yang berbeda di porsi korban.",
                        contradiction: "Lab menemukan chemical allergen sengaja ditambahkan. Korban tidak punya alergi alami."
                    },
                    deductionSteps: [
                        "Korban meninggal karena reaksi alergi",
                        "Rekam medis: tidak ada alergi alami",
                        "Lab: zat pemicu alergi BUATAN ditemukan",
                        "Hanya koki bisa memasukkan zat ke porsi spesifik"
                    ],
                    connections: [
                        { text: "Autopsi + Rekam medis = Alergi tidak natural", requires: ["Autopsi", "Rekam Medis"] },
                        { text: "Tidak ada alergi + Chemical = Racun sengaja", requires: ["Rekam Medis", "Lab Toxicology"] }
                    ]
                })
            },
            {
                id: "rain_clothes",
                generate: () => ({
                    timeline: [
                        { time: "16:00", event: "Hujan deras mulai", critical: true },
                        { time: "17:30", event: "Korban terakhir dihubungi", critical: false },
                        { time: "18:00", event: "Hujan reda", critical: true },
                        { time: "18:30", event: "Pelaku klaim tiba di TKP", critical: true },
                        { time: "19:00", event: "Korban ditemukan tewas", critical: false }
                    ],
                    evidence: [
                        { type: "open", cat: "Cuaca", label: "Data BMKG", desc: "Hujan deras 16:00-18:00" },
                        { type: "open", cat: "TKP", label: "Kondisi Teras", desc: "Lantai basah dan berlumpur" },
                        { type: "locked", cat: "Fisik", label: "Pakaian Tersangka", desc: "Pakaian KERING sempurna, sepatu bersih" },
                        { type: "locked", cat: "Saksi", label: "Kesaksian Tetangga", desc: "Melihat orang masuk jam 17:15 saat hujan, pakai jas hijau" }
                    ],
                    killerAlibi: {
                        initial: "Saya datang jam 18:30, setelah hujan reda.",
                        interrogated: "Saya naik mobil, parkir di garasi, tidak kehujanan.",
                        contradiction: "Tetangga melihat seseorang masuk jam 17:15 saat hujan. Pakaian kering karena sudah berganti."
                    },
                    deductionSteps: [
                        "Pelaku klaim datang jam 18:30 (setelah hujan)",
                        "Tetangga melihat orang masuk jam 17:15 (saat hujan)",
                        "Pakaian pelaku kering sempurna",
                        "Kesimpulan: sudah berganti baju setelah membunuh"
                    ],
                    connections: [
                        { text: "Klaim waktu + Kesaksian = Waktu sebenarnya", requires: ["Data BMKG", "Kesaksian Tetangga"] },
                        { text: "Hujan + Pakaian kering = Sudah ganti baju", requires: ["Data BMKG", "Pakaian Tersangka"] }
                    ]
                })
            },
            {
                id: "car_engine",
                generate: () => ({
                    timeline: [
                        { time: "19:00", event: "Pelaku klaim berangkat dari Bandung", critical: true },
                        { time: "21:00", event: "Korban ditemukan tewas (Jakarta)", critical: true },
                        { time: "21:15", event: "Pelaku tiba di TKP", critical: true },
                        { time: "21:20", event: "Polisi periksa mobil pelaku", critical: true }
                    ],
                    evidence: [
                        { type: "open", cat: "Jarak", label: "Rute Perjalanan", desc: "Bandung-Jakarta: ¬±150km, 2-3 jam" },
                        { type: "open", cat: "Kendaraan", label: "Kondisi Mobil", desc: "Mobil pelaku parkir di depan rumah" },
                        { type: "locked", cat: "Fisika", label: "Suhu Mesin", desc: "Mesin DINGIN TOTAL saat diperiksa 21:20" },
                        { type: "locked", cat: "Digital", label: "Data GPS Tol", desc: "Tidak ada catatan mobil lewat tol hari ini" }
                    ],
                    killerAlibi: {
                        initial: "Saya baru sampai dari Bandung jam 21:15.",
                        interrogated: "Perjalanan macet, berangkat jam 7 malam dari Bandung.",
                        contradiction: "Mesin dingin total - tidak mungkin baru jalan 150km. GPS tol tidak catat mobilnya."
                    },
                    deductionSteps: [
                        "Pelaku klaim perjalanan 150km",
                        "Mesin dingin total (butuh 30 menit dingin)",
                        "Data GPS tol: tidak ada catatan",
                        "Pelaku sudah di Jakarta sejak awal"
                    ],
                    connections: [
                        { text: "Klaim perjalanan + Mesin dingin = Alibi palsu", requires: ["Rute Perjalanan", "Suhu Mesin"] },
                        { text: "Tidak ada data tol + Mesin dingin = Tidak pernah dari Bandung", requires: ["Suhu Mesin", "Data GPS Tol"] }
                    ]
                })
            }
        ];

        // ===== GAME STATE =====
        let state = {
            reputation: 100,
            solved: 0,
            actionPoints: 5,
            maxAP: 5,
            currentCase: null,
            unlockedEvidence: [],
            interrogatedSuspects: [],
            discoveredConnections: [],
            revealedSecrets: []
        };

        // ===== UTILITIES =====
        function shuffle(arr) {
            return [...arr].sort(() => Math.random() - 0.5);
        }

        function randomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // ===== CASE GENERATION =====
        function generateCase() {
            const template = randomItem(CASE_TEMPLATES);
            const caseData = template.generate();

            const suspects = shuffle(SUSPECTS_POOL).slice(0, 3);
            const killerIndex = Math.floor(Math.random() * 3);
            const shuffledSecrets = shuffle(RED_HERRINGS);

            const formattedSuspects = suspects.map((s, i) => ({
                ...s,
                isKiller: i === killerIndex,
                initialStatement: i === killerIndex 
                    ? caseData.killerAlibi.initial 
                    : generateInnocentStatement(),
                interrogatedStatement: i === killerIndex 
                    ? caseData.killerAlibi.interrogated 
                    : generateInnocentDetail(),
                secret: i !== killerIndex ? shuffledSecrets[i] : null,
                hasSecret: i !== killerIndex
            }));

            return {
                id: Math.floor(Math.random() * 900) + 100,
                ...caseData,
                suspects: formattedSuspects,
                killerIndex
            };
        }

        function generateInnocentStatement() {
            const statements = [
                "Saya di rumah menonton TV saat kejadian.",
                "Saya sedang di masjid untuk sholat maghrib.",
                "Saya bekerja lembur di kantor.",
                "Saya makan malam di luar bersama teman."
            ];
            return randomItem(statements);
        }

        function generateInnocentDetail() {
            const details = [
                "Ada saksi yang bisa konfirmasi. Cek CCTV saja.",
                "Saya punya struk belanja dan bukti transaksi.",
                "Istri saya bisa jadi saksi, kami di rumah bersama.",
                "Teman-teman saya bisa dikonfirmasi."
            ];
            return randomItem(details);
        }

        // ===== RENDER FUNCTIONS =====
        function renderGame() {
            const c = state.currentCase;

            document.getElementById('caseNumber').textContent = '#' + c.id;
            updateStats();
            updateAP();

            // Timeline
            const timelineEl = document.getElementById('timelineList');
            timelineEl.innerHTML = c.timeline.map(t => `
                <div class="timeline-item ${t.critical ? 'critical' : ''}">
                    <span class="timeline-time">${t.time}</span>
                    <span class="timeline-event">${t.event}</span>
                </div>
            `).join('');

            // Evidence
            const evidenceEl = document.getElementById('evidenceGrid');
            evidenceEl.innerHTML = c.evidence.map((e, i) => {
                const isLocked = e.type === 'locked' && !state.unlockedEvidence.includes(i);
                return `
                    <div class="evidence-card ${isLocked ? 'locked' : ''}" onclick="${isLocked ? `unlockEvidence(${i})` : ''}">
                        <div class="ev-content">
                            <div class="ev-category">${e.cat}</div>
                            <div class="ev-label">${e.label}</div>
                            <div class="ev-desc">${e.desc}</div>
                        </div>
                    </div>
                `;
            }).join('');

            // Connections
            renderConnections();

            // Suspects
            renderSuspects();

            // Action message
            updateActionMessage();
        }

        function renderSuspects() {
            const grid = document.getElementById('suspectsGrid');
            grid.innerHTML = state.currentCase.suspects.map((s, i) => {
                const isInterrogated = state.interrogatedSuspects.includes(i);
                const isSecretRevealed = state.revealedSecrets.includes(i);

                let statementsHTML = `
                    <div class="statement-box">
                        <div class="statement-label">Pernyataan Awal</div>
                        <div class="statement-text">"${s.initialStatement}"</div>
                    </div>
                `;

                if (isInterrogated) {
                    statementsHTML += `
                        <div class="statement-box interrogated">
                            <div class="statement-label">Hasil Interogasi</div>
                            <div class="statement-text">"${s.interrogatedStatement}"</div>
                        </div>
                    `;
                }

                if (isSecretRevealed && s.secret) {
                    statementsHTML += `
                        <div class="statement-box secret">
                            <div class="statement-label">‚ö†Ô∏è Rahasia Terungkap</div>
                            <div class="statement-text">"${s.secret.confession}"</div>
                        </div>
                    `;
                }

                return `
                    <div class="suspect-card">
                        <div class="suspect-header">
                            <span class="suspect-avatar">${s.avatar}</span>
                            <div class="suspect-info">
                                <h3>${s.name}</h3>
                                <div class="suspect-role">${s.role}</div>
                            </div>
                        </div>
                        <div class="suspect-body">
                            ${statementsHTML}
                            <div class="suspect-actions">
                                <button class="btn btn-investigate" onclick="interrogate(${i})" ${isInterrogated || state.actionPoints <= 0 ? 'disabled' : ''}>
                                    üîç Interogasi <span class="ap-cost">-1 AP</span>
                                </button>
                                <button class="btn btn-accuse" onclick="accuse(${i})">
                                    ‚öñÔ∏è Tuduh Sebagai Pelaku
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderConnections() {
            const list = document.getElementById('connectionsList');
            list.innerHTML = state.currentCase.connections.map((c, i) => {
                const found = state.discoveredConnections.includes(i);
                return `<div class="connection-item ${found ? 'found' : ''}">${found ? c.text : 'Koneksi tersembunyi...'}</div>`;
            }).join('');
        }

        function updateAP() {
            const dots = document.querySelectorAll('.ap-dot');
            dots.forEach((d, i) => {
                d.classList.toggle('used', i >= state.actionPoints);
            });
        }

        function updateStats() {
            const repEl = document.getElementById('repValue');
            repEl.textContent = state.reputation;
            repEl.classList.toggle('low', state.reputation < 30);
            document.getElementById('solvedValue').textContent = state.solved;
        }

        function updateActionMessage() {
            const bar = document.getElementById('actionBar');
            const msg = document.getElementById('actionMessage');

            if (state.actionPoints <= 0) {
                bar.classList.add('danger');
                msg.className = 'action-message danger';
                msg.textContent = '‚ö†Ô∏è POIN AKSI HABIS! Anda harus menuduh sekarang!';
            } else if (state.actionPoints <= 2) {
                bar.classList.remove('danger');
                msg.className = 'action-message warning';
                msg.textContent = `‚ö° Sisa ${state.actionPoints} poin aksi. Gunakan dengan bijak!`;
            } else {
                bar.classList.remove('danger');
                msg.className = 'action-message';
                msg.textContent = 'Kumpulkan bukti dan interogasi untuk menemukan kontradiksi.';
            }
        }

        // ===== GAME ACTIONS =====
        function useAP() {
            if (state.actionPoints > 0) {
                state.actionPoints--;
                updateAP();
                updateActionMessage();
                return true;
            }
            return false;
        }

        function unlockEvidence(index) {
            if (state.unlockedEvidence.includes(index)) return;
            if (!useAP()) return;

            state.unlockedEvidence.push(index);
            checkConnections();
            renderGame();
        }

        function interrogate(index) {
            if (state.interrogatedSuspects.includes(index)) return;
            if (!useAP()) return;

            state.interrogatedSuspects.push(index);

            const suspect = state.currentCase.suspects[index];
            if (suspect.hasSecret && !suspect.isKiller && Math.random() > 0.5) {
                state.revealedSecrets.push(index);
            }

            renderSuspects();
            updateActionMessage();
        }

        function checkConnections() {
            const c = state.currentCase;
            const unlockedLabels = state.unlockedEvidence.map(i => c.evidence[i].label);

            c.evidence.forEach((e, i) => {
                if (e.type === 'open' && !unlockedLabels.includes(e.label)) {
                    unlockedLabels.push(e.label);
                }
            });

            c.connections.forEach((conn, i) => {
                if (!state.discoveredConnections.includes(i)) {
                    if (conn.requires.every(r => unlockedLabels.includes(r))) {
                        state.discoveredConnections.push(i);
                    }
                }
            });

            renderConnections();
        }

        function accuse(index) {
            const suspect = state.currentCase.suspects[index];
            const c = state.currentCase;

            const modal = document.getElementById('resultModal');
            const icon = document.getElementById('modalIcon');
            const title = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');
            const steps = document.getElementById('deductionSteps');
            const btn = document.getElementById('modalBtn');

            if (suspect.isKiller) {
                const bonus = state.actionPoints * 5;
                state.reputation += 15 + bonus;
                state.solved++;

                icon.className = 'modal-icon success';
                icon.textContent = '‚úì';
                title.className = 'modal-title success';
                title.textContent = 'PELAKU TERTANGKAP!';
                content.innerHTML = `<strong>${suspect.name}</strong> adalah pelakunya!<br><br>${c.killerAlibi.contradiction}`;

                steps.style.display = 'block';
                steps.innerHTML = '<strong>Rantai Deduksi:</strong>' + c.deductionSteps.map((s, i) => `
                    <div class="deduction-step">
                        <span class="step-num">${i + 1}</span>
                        <span>${s}</span>
                    </div>
                `).join('');

                btn.textContent = 'KASUS BERIKUTNYA';
                btn.onclick = () => { closeModal(); nextCase(); };
            } else {
                state.reputation -= 25;

                icon.className = 'modal-icon error';
                icon.textContent = '‚úó';
                title.className = 'modal-title error';
                title.textContent = 'TUDUHAN SALAH!';

                let msg = `<strong>${suspect.name}</strong> bukan pelakunya.`;
                if (suspect.secret && state.revealedSecrets.includes(index)) {
                    msg += `<br><br>Rahasia mereka (${suspect.secret.secret}) memang mencurigakan, tapi itu adalah <strong>RED HERRING</strong>.`;
                }
                msg += '<br><br>Reputasi -25.';

                content.innerHTML = msg;
                steps.style.display = 'none';

                btn.textContent = 'LANJUT INVESTIGASI';
                btn.onclick = () => { closeModal(); checkGameOver(); };
            }

            modal.classList.add('visible');
            updateStats();
        }

        function skipCase() {
            state.reputation -= 30;
            updateStats();
            if (!checkGameOver()) nextCase();
        }

        function closeModal() {
            document.getElementById('resultModal').classList.remove('visible');
        }

        function nextCase() {
            state.actionPoints = state.maxAP;
            state.unlockedEvidence = [];
            state.interrogatedSuspects = [];
            state.discoveredConnections = [];
            state.revealedSecrets = [];
            state.currentCase = generateCase();
            checkConnections();
            renderGame();
        }

        function checkGameOver() {
            if (state.reputation <= 0) {
                document.getElementById('finalSolved').textContent = state.solved;
                document.getElementById('gameOver').classList.add('visible');
                return true;
            }
            return false;
        }

        function startGame() {
            document.getElementById('startScreen').classList.add('hidden');
            document.getElementById('gameContainer').classList.add('visible');
            nextCase();
        }
    </script>
</body>
</html>
